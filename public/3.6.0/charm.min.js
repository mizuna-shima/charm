/*!
 * Charm.js ver 3.6.0
 * Charm.js License (Revised January 14, 2024)
 * Copyright (c) Mizuna Shima
 * Website: https://lanama.net/scripts/charm/
 * 
 * Subject to the conditions set forth below, anyone who obtains a copy of this script is granted permission to use it for commercial and non-commercial purposes free of charge.
 * Please adhere to the following usage rules:
 * 1. When used commercially or redistributed, significant parts must include the author's credit and the official distributor.
 * 2. Do not remove the credits and license text within the file.
 * 3. Do not sell the script, nor any product primarily based on this script.
 * 4. Do not use the saved data from this script for monetary claims or requests for goods.
 * Even if the user modifies this script, these rules must be followed.
 * 
 * The author or copyright owner of this script shall not be liable for any damages or issues under any contract, tort, or other liabilities, in any case.
 */

class Charm{static nameClass="charm";static syncNow="charmnow";static syncNowSession="charmnowsession";static setNameId="charmset";static setSessionId="charmsession";static unsetNameId="charmunset";static viewRegisterSession="charmsessionmsg";static sessionString="（一時保存しました）";static storageKeyName="charm";static useEncryption=0;static maxSize=50;static setReload=0;static unsetReload=0;static showStorageError=0;static echoCountDefault=2;static sttCountDefault=2;static charmClassList={charmShort:"charm_short",charmSkip:"charm_skip",charmChop:"charm_chop",charmLast:"charm_last",charmParse:"charm_pause",charmEcho:"charm_echo",charmOverlap:"charm_overlap",charmStutter:"charm_stutter",charmRev:"charm_rev",charmHira:"charm_hira",charmKana:"charm_kana",charmMix:"charm_mix",charmVowel:"charm_vowel",charmVowelMin:"charm_vowel_min",charmInitial:"charm_initial",charmSymbol:"charm_symbol",charmCount:"charm_count"};static oldSet="charm-setname";static oldUnset="charm-unsetname";static run(){const runner=globalThis?.CharmRunner;"function"==typeof runner?.start?runner.start():console.warn("CharmRunner is not available.")}static addExtension(name,ex){CharmRunner.addExtension(name,ex)}static addEExtension(name,ex){CharmRunner.addEExtension(name,ex)}}"undefined"!=typeof window&&(window.Charm=Charm);

!function(){"use strict";class CharmInput$1{static#t;static#s=null;static#i=!1;static t(){this.#t=this.#h(this.i,100),this.#s=document.getElementsByClassName(Charm.nameClass),this.#i=this.#e(),this.#a(),this.h(),this.o(),this.l()}static h(){[{m:Charm.setNameId,u:Charm.oldSet,p:()=>this.C("local")},{m:Charm.setSessionId,u:null,p:()=>this.C("session")},{m:Charm.unsetNameId,u:Charm.oldUnset,p:this.S}].forEach((({m:t,u:s,p:i})=>{let h=document.getElementById(t);!h&&s&&(h=document.getElementById(s)),h&&(h.removeEventListener("click",i,!1),h.addEventListener("click",i,!1))}))}static o(){const t=document.getElementsByClassName(Charm.syncNow),s=document.getElementsByClassName(Charm.boundSession),i=this.#t,addListeners=t=>{for(const s of[...t])for(const t of["input","compositionend"])s.removeEventListener(t,i,!1),s.addEventListener(t,i,!1)};addListeners(t),addListeners(s)}static#h(t,s){let i;return(...h)=>{i&&clearTimeout(i),i=setTimeout((()=>{t.apply(this,h)}),s)}}static#r(){for(const t of this.#s)!t||t.value.length<1||(CharmStorage.k={I:t.id,value:t.value})}static l(){[...this.#s].forEach((t=>{t.id in CharmStorage.k?t.value=CharmStorage.k[t.id]:t.value=""}))}static C(t){this.#r(),CharmStorage.v(CharmStorage.T[t]),this.l(),1===Charm.setReload&&location.reload()}static O(){this.C("local")}static M(){this.C("session")}static S(){CharmStorage.R(),CharmInput$1.l(),Charm.unsetReload&&location.reload()}static async i(t){const s=t.target,i=s.classList.contains(Charm.syncNow),h=s.id,e=s.value;if(""!==e)return CharmStorage.k={I:h,value:e,$:!0,N:i},void CharmInput$1.l();e||CharmStorage.L(h,i)}static#e(){const t=document.querySelector("script[data-charm-unset-reload]");return t?.hasAttribute("data-charm-unset-reload")||1===Charm.unsetReload}static U(t=null){this.#i&&(this.#a(t),location.reload())}static#a(t=null){if(this.#i)if("string"==typeof t)sessionStorage.setItem("focusId",t);else{const t=sessionStorage.getItem("focusId"),s=document.getElementById(t);s&&s.focus(),sessionStorage.removeItem("focusId")}}}class CharmStorage$1{static#n="C3D1A4F7B6E2A5B8C9D1F2A3B7E6F4D9";static#c=BigInt("0x"+this.#n.match(/.{1,4}/g).reverse().join(""));static#o={};static#l=!0;static#m="";static#u=!1;static T=Object.freeze({A:!0,session:!1});static t(){this.#m=this.#d(),this.#p()}static#d(){const t=document.querySelector("script[data-charm-storage]");return t?.getAttribute("data-charm-storage")??Charm.storageKeyName}static#p(){let t=null,s=null;try{t=localStorage.getItem(this.#m),t||(t=sessionStorage.getItem(this.#m),this.#l=!t,s=!!t)}catch(s){this.#C(s),t=null}t?(t=JSON.parse(t),t&&"object"==typeof t||(t={})):t={},s&&(TextRenderer.B(!0),this.#l=this.T.session),this.#o=this.D(t)}static j(){this.#o={}}static v(t=this.T.A,s=null){if(TextRenderer.update(s),0===Object.keys(this.#o).length)return;let i=t?localStorage:sessionStorage,h=t?sessionStorage:localStorage;this.#l=t;let e=this.#o;e=this.D(e);try{i.setItem(this.#m,JSON.stringify(e)),h.removeItem(this.#m)}catch(t){this.#C(t)}finally{TextRenderer.B(!this.#l)}Charm.setReload&&!this.#u&&location.reload()}static R(){this.j(),TextRenderer.ini();try{localStorage.removeItem(this.#m),sessionStorage.removeItem(this.#m)}catch(t){this.#C(t)}finally{TextRenderer.B(!1)}}static get k(){return this.#o}static set k({I:t,value:s,$:i=!1,N:h=!0}){let e=s;Charm.maxSize&&e.length>Charm.maxSize&&(e=e.slice(0,Charm.maxSize)+"…"),t&&void 0!==e&&(this.#o[t]=e),this.#u=i,i&&this.v(h,t)}static L(t,s=!0){delete this.#o[t],TextRenderer.F(t);let i=null;Object.keys(this.#o).length?(i=t,this.v(s)):this.R(),CharmInput.U(i)}static#C(t){let s="その他のエラーが発生しました";t instanceof DOMException&&"QuotaExceededError"===t.name?s="ローカルストレージの容量がいっぱいです。名前変換は行わずにデフォルトネームを表示します。":t instanceof DOMException&&"SecurityError"===t.name&&(s="セキュリティ設定によりローカルストレージが使用できません。名前変換は行わずにデフォルトネームを表示します。"),Charm.showStorageError&&!this.#u&&alert(s),console.warn(s,t)}static D(t={}){return Charm.useEncryption?Object.fromEntries(Object.entries(t).map((([t,s])=>[t,this.#f(s)]))):t}static#f(t){if(!Charm.useEncryption)return t;const s=this.#c;return Array.from(t,((t,i)=>String.fromCharCode(t.charCodeAt(0)^Number(s>>(BigInt(31&i)<<2n)&0xffn)))).join("")}}class CUtil{static K=Object.freeze(["&#8230;&#8230;","&#8230;","&#12540;","&#8213;&#8213;","&#12336;&#12336;","&#12336;","&#12316;","&#65281;","&#65281;&emsp;","&#65311;","&#65311;&emsp;","&#63;","&#33;","&#12289;","&#12290;","&#12539;","&#44;","&#65292;","&#8741;","&#47;","&#65295;","&#9675;&#9675;","&#9675;","&#215;&#215;","&#215;","&#9734;&#9734;","&#9734;","&#9733;&#9733;","&#9733;","&#9825;&#9825;","&#9825;","&#9734;&emsp;","&#9733;&emsp;","&#9825;&emsp;","&#9834;","&#9834;&emsp;","&#65281;&#65311;","&#65281;&#65311;&emsp;","&#x3063;","&#x3063;&#65281;","&#x3063;&#65281;&emsp;","&#x3063;&#12289;","&#x3063;&#8230;&#8230;","&#x30c3;","&#x30c3;&#65281;","&#x30c3;&#65281;&emsp;","&#x30c3;&#12289;","&#x30c3;&#8230;&#8230;"]);static#g="&#12289;";static#S="&#8230;&#8230;";static get H(){return this.#g}static get P(){return this.#S}}globalThis.CharmInput=CharmInput$1,globalThis.CharmRunner=class{static V=[];static J=[];static G={};static Z={};static async start(){await this.Y(),CharmStorage.t(),CharmInput.t(),TextRenderer.t(),await this.W()}static addExtension(t,s){this.G[t]=s,this.V.push(t)}static addEExtension(t,s){this.Z[t]=s,this.J.push(t)}static async q(t,s){for(const i of t){const t=s[i];t?.run instanceof Function&&await t.run()}}static async Y(){await this.q(this.V,this.G)}static async W(){await this.q(this.J,this.Z)}},globalThis.CharmStorage=CharmStorage$1,globalThis.CUtil=CUtil,globalThis.CustomOptions=class{#x;#y;#k;#I;#v;constructor(t,s){this.#x=t,this.#y=s,this.#k={short:!1,skip:!1,chop:!1,last:!1,stutter:!1,pause:!1,echo:!1,rev:!1,overlap:!1,vowel:!1,ini:!1,hira:!1,kana:!1,mix:!1},this.#I={count:void 0,symbol:void 0,vowelMin:!1},this.#v={short:this.#E.bind(this),skip:this.#b.bind(this),chop:this.#T.bind(this),last:this.#w.bind(this),stutter:this.#O.bind(this),pause:this.#M.bind(this),echo:this.#R.bind(this),rev:this.#$.bind(this),overlap:this.#N.bind(this),vowel:this.#L.bind(this),initial:this.#U.bind(this)},this.#A()}get custom(){return{expression:this.#k,option:this.#I}}#A(){for(const t in this.#v)if(this.#v[t]())break;this.#B(),this.#D(),this.#j()}#F(){const t=Charm.charmClassList.charmCount,s=[...Array(9)].findIndex(((s,i)=>this.#y.contains(`${t}${i+1}`)));return-1!==s?s+1:null}#K(){const t=Charm.charmClassList.charmSymbol,s=[...Array(48)].findIndex(((s,i)=>{const h=(i+1).toString().padStart(2,"0");return this.#y.contains(`${t}${h}`)||this.#y.contains(`${t}${i+1}`)}));return-1!==s?CUtil.K[s]:null}#E(){if(this.#x.charmShort)this.#I.count=+this.#x.charmShort||1;else{if(!this.#y.contains(Charm.charmClassList.charmShort))return!1;this.#I.count=this.#F()||1}return this.#k.short=!0,!0}#H(t,s,i){return!(!this.#x[s]&&!this.#y.contains(Charm.charmClassList[i]))&&(this.#k[t]=!0,!0)}#b(){return this.#H("skip","charmSkip","charmSkip")}#T(){return this.#H("chop","charmChop","charmChop")}#w(){return this.#H("last","charmLast","charmLast")}#$(){return this.#H("rev","charmRev","charmRev")}#U(){return this.#H("initial","charmInitial","charmInitial")}#O(){return!("stutter"!==this.#x.charmCall&&!this.#y.contains(Charm.charmClassList.charmStutter))&&(this.#k.stutter=!0,"stutter"===this.#x.charmCall&&(this.#I.count=+this.#x.charmSttCount||Charm.sttCountDefault,this.#I.symbol=this.#x.charmBreak||CUtil.H),this.#y.contains(Charm.charmClassList.charmStutter)&&(this.#I.count=this.#F()||Charm.sttCountDefault,this.#I.symbol=this.#K()||CUtil.H),!0)}#M(){if("pause"===this.#x.charmCall)this.#I.symbol=this.#x.charmBreak||CUtil.P;else{if(!this.#y.contains(Charm.charmClassList.charmParse))return!1;this.#I.symbol=this.#K()||CUtil.P}return this.#k.pause=!0,!0}#R(){return!("echo"!==this.#x.charmCall&&!this.#y.contains(Charm.charmClassList.charmEcho))&&(this.#k.echo=!0,"echo"===this.#x.charmCall&&(this.#I.count=+this.#x.charmEchCount||Charm.echoCountDefault,this.#I.symbol=this.#x.charmBreak||CUtil.P),this.#y.contains(Charm.charmClassList.charmEcho)&&(this.#I.count=this.#F()||Charm.echoCountDefault,this.#I.symbol=this.#K()||CUtil.P),!0)}#N(){if(!this.#x.charmOverlap&&!this.#y.contains(Charm.charmClassList.charmOverlap))return!1;this.#k.overlap=!0;return this.#x.charmOverlap&&(this.#I.count=+this.#x.charmOvlCount||2),this.#y.contains(Charm.charmClassList.charmOverlap)&&(this.#I.count=this.#F()||2),!0}#L(){return!!(this.#x.charmVowel||this.#y.contains(Charm.charmClassList.charmVowel)||this.#x.charmVowelMin||this.#y.contains(Charm.charmClassList.charmVowelMin))&&(this.#k.vowel=!0,(this.#x.charmVowelMin||this.#y.contains(Charm.charmClassList.charmVowelMin))&&(this.#I.vowelMin=!0),this.#x.charmVowelCount?(this.#I.count=+this.#x.charmVowelCount||0,!0):(this.#I.count=this.#F()||0,!0))}#P(t,s,i){const h=this.#x[s];return!("on"!==h&&"1"!==h&&!this.#y.contains(Charm.charmClassList[i]))&&(this.#k[t]=!0,!0)}#B(){return this.#P("hira","charmHira","charmHira")}#D(){return this.#P("kana","charmKana","charmKana")}#j(){return this.#P("mix","charmMix","charmMix")}},globalThis.NameGeneration=class{#V;#J;#G;#Z;#Y;#z;constructor(t,s){this.#V=s.expression,this.#J=s.option,this.#G=t,this.#Z=t,this.#Y=[],this.#z={short:this.X.bind(this),skip:this._.bind(this),chop:this.tt.bind(this),last:this.st.bind(this),stutter:this.it.bind(this),pause:this.ht.bind(this),echo:this.et.bind(this),rev:this.rt.bind(this),overlap:this.nt.bind(this),vowel:this.ct.bind(this),initial:this.ot.bind(this),hira:this.lt.bind(this),kana:this.ut.bind(this),mix:this.dt.bind(this)},this.Ct()}get ft(){return this.#Z}Ct(){this.gt(),Object.keys(this.#V).forEach((t=>{if(this.#V[t]){const s=this.#z[t];"function"==typeof s&&s()}}))}gt(t=null){const s=t??this.#G,i=/[ぁぃぅぇぉゕゖっゃゅょゎァィゥェォヵㇰヶㇱㇲッㇳㇴㇵㇶㇷㇸㇹㇺャュョㇻㇼㇽㇾㇿヮｧｨｩｪｫｬｭｮｯ・ー]/,h=[];let e=0;for(;e<s.length;){let t=s[e];for(e++;e<s.length&&i.test(s[e]);)t+=s[e],e++;h.push(t)}if(t)return h;this.#Y=h}X(){const{count:t}=this.#J,s=this.#Y;if(t>=s.length)return void(this.#Z=s.join(""));const i=s.slice(0,t);i[t-1]=i[t-1].replace(/[っッーｯ・]/g,""),this.#Z=i.join("")}_(){this.#Y.shift(),this.#Z=this.#Y.join("")}tt(){this.#Y.pop(),this.#Z=this.#Y.join("")}st(){this.#Z=this.#Y[this.#Y.length-1]}it(){const{count:t,symbol:s}=this.#J,i=this.#Y[0]+s;this.#Z=i.repeat(t).slice(0,-s.length)}ht(){this.#Z=this.#Y.join(this.#J.symbol)}et(){const{count:t,symbol:s}=this.#J,i=this.#Y,h=[];for(let s=Math.min(t,i.length-1);s>0;s--)h.unshift(i.slice(-s).join(""));this.#Z=h.join(s)+s}rt(){this.#Z=this.#Y.reverse().join("")}nt(){this.#Z=this.#Y.map((t=>t.repeat(this.#J.count))).join("")}ct(){const t=["あ","ア","い","イ","う","ウ","え","エ","お","オ"],s=["ぁ","ァ","ぃ","ィ","ぅ","ゥ","ぇ","ェ","ぉ","ォ"],i=new Map([["あかさたなはまやらわがざだばぱゃぁゕゎ",0],["アカサタナハマヤラワガザダナパァヵㇵャㇻヮ",1],["いきしちにひみりゐぎじぢびぃヰ",2],["イキシチニヒミリギジヂビィㇱㇶㇼ",3],["うくすつぬふむゆるぐずづぶぷゅぅっ",4],["ウクスヌヌフムユルグズヅブプュゥㇰㇲッㇴㇷㇽ",5],["えけせてねへめれゑげぜでべぺぇゖ",6],["エケセテネヘメレゲゼデベペェヶㇸㇾ",7],["おこそとのほもよろをごぞどぼぽょぉ",8],["オコソトノホモヨロヲゴゾドボポョォㇳㇹㇺㇿ",9],["んー〜～〰ン",-1]]),h=this.#G.slice(-1),e=this.#J,a=Math.max(1,e.count??1),r=!e.vowelMin;for(const[e,n]of i)if(new RegExp(`[${e}]$`).test(h)){if(n>=0){const i=r?t[n]:s[n];this.#Z=i.repeat(a)}else this.#Z=h.repeat(a);return}this.#Z=""}ot(){const t=this.#Y[0].charAt(0);if(/^[a-zA-Zａ-ｚＡ-Ｚ]/.test(t))return void(this.#Z=t.normalize("NFKC").toUpperCase());if(!/^[ぁ-ゟァ-ヿ]/.test(t))return void(this.#Z="");const s=[[/^[がぎぐげごガギグゲゴ]/,"G"],[/^[ざじずぜぞザジズゼゾ]/,t=>/[じジ]/.test(t[0])?"J":"Z"],[/^[だぢでどダヂデド]/,t=>/[ぢヂ]/.test(t[0])?"J":"D"],[/^[づヅ]/,"Z"],[/^[ばびぶべぼバビブベボ]/,"B"],[/^[ぱぴぷぺぽパピプペポ]/,"P"],[/^[ゔヴ]/,"V"],[/^[あぁアァ]/,"A"],[/^[いぃイィゐヰ]/,"I"],[/^[うぅウゥ]/,"U"],[/^[えぇエェゑヱ]/,"E"],[/^[おぉオォ]/,"O"],[/^[か-こカ-コヵ]/,"K"],[/^[さ-そサ-ソ]/,"S"],[/^[た-とタ-ト]/,t=>/[ちチ]/.test(t[0])?"C":"T"],[/^[な-のナ-ノ]/,"N"],[/^[は-ほハ-ホ]/,t=>/[ふフ]/.test(t[0])?"F":"H"],[/^[ま-もマ-モ]/,"M"],[/^[ゃ-よャ-ヨ]/,"Y"],[/^[ら-ろラ-ロ]/,"R"],[/^[わをワヲ]/,"W"],[/^[んン]/,"N"]];for(const[i,h]of s){const s=t.match(i);if(s)return void(this.#Z="function"==typeof h?h(s):h)}this.#Z=""}St(t){return t.replace(/[ァ-ヶ]/g,(t=>String.fromCharCode(t.charCodeAt(0)-96)))}xt(t){return t.replace(/[ぁ-ゖ]/g,(t=>String.fromCharCode(t.charCodeAt(0)+96)))}lt(){this.#Z=this.St(this.#Z)}ut(){this.#Z=this.xt(this.#Z)}dt(){const t=this.gt(this.#Z);this.#Z=t.map(((t,s)=>s%2==0?this.xt(t):this.St(t))).join("")}},globalThis.TextRenderer=class{static#Q="data-charm-before";static#W={};static#q={};static t(){this.ini(),this.update()}static ini(){this.yt(),this.#W=[],this.#q={}}static update(t=null){if(t)return this.#q[t]=document.getElementsByClassName(t),void this.#X(t);this.#_()}static#_(){let t=CharmStorage.k;for(const s in t)t.hasOwnProperty(s)&&(this.#q[s]=document.getElementsByClassName(s),this.#X(s))}static#X(t){const s=this.#q[t];this.#W[t]||(this.#W[t]=[]);for(let i=0;i<s.length;i++){const h=s[i];if(!h.getAttribute(`${this.#Q}`)){const s=h.textContent;this.#W[t].includes(s)||this.#W[t].push(s);const i=this.#W[t].indexOf(s);h.setAttribute(this.#Q,i)}const e=CharmStorage.k[t];this.#tt(h,e)}}static#tt(t,s){let i=s;const h=new CustomOptions(t.dataset,t.classList);i=new NameGeneration(s,h.custom).ft,this.kt(t,i)}static yt(){let t=this.#W;for(const s in t)t.hasOwnProperty(s)&&this.F(s)}static F(t){if(!this.#W[t])return;const s=document.querySelectorAll(`.${t}[${this.#Q}]`);this.It(s,t)}static It(t,s){t.forEach((t=>{const i=parseInt(t.getAttribute(`${this.#Q}`));this.kt(t,this.#W[s][i]),t.removeAttribute(this.#Q)}))}static B(t=!0){let s=document.getElementById(Charm.viewRegisterSession);s&&(s.textContent=t?Charm.sessionString:"")}static kt(t,s){if(!t)return void console.warn("safelySetText: 無効な要素が渡されました");const i=(new DOMParser).parseFromString(s,"text/html");t.textContent=i.body.textContent||""}},document.addEventListener("DOMContentLoaded",(()=>{try{window.Charm?.run()}catch(t){console.error("Charm.run() failed:",t)}}))}();


/*! - 拡張用コードは以下に追記するか、外部ファイルとしてcharm.jsの後に読み込み - */